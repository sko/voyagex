- if is_mobile
  #content_home{role: 'main'}
    %fieldset.upload_source_select{data: {role: 'controlgroup', type: 'horizontal'}}
      %input{type: 'radio', id: 'home_administration', name: 'home', value: 'administration', checked: true, onclick: 'toggleHomeTab(this)'}
      = label_tag 'home_administration', 'Administration'
      %input{type: 'radio', id: 'home_stats', name: 'home', value: 'stats', onclick: 'toggleHomeTab(this)'}
      = label_tag 'home_stats', 'Stats'
      %input{type: 'radio', id: 'home_help', name: 'home', value: 'help', onclick: 'toggleHomeTab(this)'}
      = label_tag 'home_help', 'Help'
    .messages
      #upload_error
      #upload_message
      #upload_progress
    #administration
      %span.whoami{style: 'float :left; padding: 13px 0px 13px 0px;'}
        - if user_signed_in?
          = link_to t('auth.whoami', username: tmp_user().username), change_username_path, data: { remote: "true", format: :js }
        - else
          %span
            #{t('auth.whoami', username: tmp_user().username).html_safe}
      .logout-link{style: "float: left; display: #{user_signed_in? ? 'block' : 'none'}; padding: 13px 0px 0px 0px;"}
        = link_to t('auth.sign_out'), destroy_user_session_path, style: 'margin-left: 20px;', data: { remote: "true", format: :js, method: :delete }
      #content_auth{style: 'float: left;'}
        - popup_params = { data: { rel: 'popup', 'position-to' => 'window', 'data-role' => 'button' } }
        .login-link{style: "display: #{user_signed_in? ? 'none' : 'block'}; float: left;"}
          = link_to t('auth.sign_in'), '#sign_in_modal', popup_params
        .reg-link{style: "display: #{user_signed_in? ? 'none' : 'block'}; margin-left: 20px;"}
          = link_to t('auth.sign_up'), '#sign_up_modal', popup_params.merge(style: 'margin-left: 20px;')
      #lang_select{style: 'float: right;'}
        - lcls = lang_change_links request, ['c']
        %div{style: 'float: left; margin: 10px 10px 0px 20px;'}
          = link_to image_tag("/assets/en.png", style: "border-width:0px;width:30px;height:20px;"), '#', onclick: "javascript:document.location.href=window.clientState.linkForView('#{lcls[0]}', 'en', '#{lcls[1]}');", :style => "color:#00dd;"
        %div{style: 'float: right; margin: 10px 10px 0px 0px;'}
          = link_to image_tag("/assets/de.png", style: "border-width:0px;width:30px;height:20px;"), '#', onclick: "javascript:document.location.href=window.clientState.linkForView('#{lcls[0]}', 'de', '#{lcls[1]}');", :style => "color:#00dd;"
      = render partial: '/users/settings.mobile'
    = render partial: '/shared/uploads.mobile', locals: {resource: Upload.new, resource_name: :upload}
    = render partial: '/sandbox/stats.mobile'
    = render partial: '/shared/help'
- else
  #content_home
    = render partial: '/users/settings'
    = render partial: '/shared/uploads', locals: {resource: Upload.new, resource_name: :upload}
  
  = render partial: '/shared/help'

= render partial: '/users/follow_templates'

#content_chat.talk_message
  = form_tag '#', method: :post, remote: true

  - if is_mobile
    .talk_message_data
      = text_area_tag :message, '', class: :talk_message_text, maxlength: 1500
  - else
    %table{style: 'width:100%;'}
      %tr
        %td{valign: 'top', style: 'width:50px;'}
          .talk_message_label
            Chat:
        %td
          .talk_message_data
            = text_area_tag :message, '', class: :talk_message_text, maxlength: 1500

#content_map
  -#
    = map(:center => { latlng: [51.3767, 7.49389],
        zoom: 16 },
        tile_layer: "http://{s}.tiles.mapbox.com/v4/stephankoeller.k5hhdli3/{z}/{x}/{y}.png?access_token=pk.eyJ1Ijoic3RlcGhhbmtvZWxsZXIiLCJhIjoiZEFHdnhwayJ9.AdtZiG5HGi5JAb64G1K-jA",
        subdomains: ['a'],
        access_token: 'pk.eyJ1Ijoic3RlcGhhbmtvZWxsZXIiLCJhIjoiZEFHdnhwayJ9.AdtZiG5HGi5JAb64G1K-jA',
        max_zoom: 30,
        layers: [window.VoyageX.MapControl.tileLayer])
  %canvas{id: 'tile_canvas', style: 'display: none; width: 256px; height: 256px;'}
  %canvas{id: 'attachment_canvas', style: 'display: none;'}
  #map
  %script
    var view = new VoyageX.View();
    var offlineZooms = [4,8,12,16];
    var zooms = [#{(1..16).collect{|n|",#{n}"}.join.sub(/^,/,'')}];
    var mapOptions = { center: new L.LatLng(#{51.3767}, #{7.49389}),
    zooms: zooms,
    zoom: 16,
    subdomains: ['a'],
    access_token: 'pk.eyJ1Ijoic3RlcGhhbmtvZWxsZXIiLCJhIjoiZEFHdnhwayJ9.AdtZiG5HGi5JAb64G1K-jA',
    max_zoom: 30 }
    /var mapControl = new VoyageX.MapControl(VoyageX.StorageStrategy.instance(), mapOptions, offlineZooms, true) 
    new VoyageX.Main(currentUser, VoyageX.StorageStrategy.instance(), view, mapOptions, offlineZooms, true) 
    -#var map = new L.Map('map',
      ).on('zoomend', function(e) {
      zoomEnd(e);
      });
    -#var map = mapControl.map();
      map.on('zoomend', function(e) {
      zoomEnd(e);
      });
      $('#zoom_level').html('<span style="color:white;">zoom: '+map.getZoom()+'</span>')

  -#
    :javascript
      map.on('locationfound', function(e) {
        alert('found location...')
      });
      map.on('locationerror', function(e) {
        alert('geolocation timed out - manual selection required.\nsetting default location...')
      });
